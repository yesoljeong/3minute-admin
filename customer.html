<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&family=Noto+Sans:wght@400;700&display=swap"
        rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <title>3분 부동산 admin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            text-decoration: none;
            list-style: none;
            box-sizing: border-box;
            color: #676A6C;
        }

        body {
            background-color: #F3F3F4;
        }

        .clear::after {
            content: "";
            display: block;
            clear: both;
        }

        /* HEADER */
        header {
            position: relative;
            height: 100px;
            z-index: 1;
        }

        header h1 {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px;
            text-align: center;
            font-family: 'Noto Sans', sans-serif;
            font-family: 'Noto Sans KR', sans-serif;
            color: #fff;
            background-color: #1AB394;
            height: 100px;
        }

        header .fas {
            color: #fff;
        }

        /* NAV */
        nav,
        section {
            background-color: #fff;
            border: 1px solid #E7EAEC;
        }

        nav {
            float: left;
            background-color: #233645;
            position: fixed;
            top: 100px;
            width: 15%;
            height: 100vh;
            /* border:1px solid red; */
        }

        nav .login_info {
            /* border:1px solid red; */
            text-align: center;
            padding: 50px 0;
            background-color: #233645;
        }

        nav .login_info .fas {
            /* border: 1px solid red; */
            font-size: 50px;
            margin-bottom: 10px;
        }

        nav .login_info h3 {
            /* border: 1px solid red; */
            color: #fff;
        }

        nav ul li {
            font-weight: 700;
            font-family: 'Noto Sans', sans-serif;
            font-family: 'Noto Sans KR', sans-serif;
            padding: 10px 20px;
        }

        nav ul li:nth-child(3) {
            background-color: #1AB394;
            color: #fff;
        }

        nav ul li:nth-child(3) span,
        nav ul li:nth-child(3) .fas {
            color: #fff;
        }

        nav ul li a {
            vertical-align: middle;
            color: #9FAABE;
            display: inline-block;
            width: 100%;
            height: 100%;
        }

        nav .fas {
            font-size: 20px;
            vertical-align: middle;
            margin-right: 15px;
            color: #9FAABE;
        }

        /* SECTION ASIDE WRAP*/
        .sec_aside {
            display: flex;
            justify-content: space-between;
            width: 85%;
            float: right;
        }

        .top {
            text-align: right;
            height: 60px;
            vertical-align: middle;
        }

        .top button {
            width: 80px;
            padding: 10px;
            background-color: #1AB394;
            border: 1px solid #c8c9ca;
            border-radius: 5px;
            cursor: pointer;
            color: #fff;
            vertical-align: middle;
        }

        /* SECTION */
        section {
            padding: 10px 20px;
            width: 100%;
            margin-bottom: 150px;
            /* border: 1px solid red; */
        }

        section.harf {
            width: 60%;
        }

        section .top {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            height: 80px;
        }

        section .search_bar {
            text-align: right;
        }

        section .search_bar input {
            width: 300px;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #c8c9ca;
            margin-right: 15px;
        }

        section .search_bar .fas {
            padding-right: 20px;
            color: #1AB394;
            font-size: 25px;
            vertical-align: middle;
        }

        #customers {
            display: flex;
            flex-flow: column-reverse;
        }

        section ul {
            display: flex;
            justify-content: space-around;
            border-bottom: 1px solid #E7EAEC;
            align-items: center;
        }

        section .table_title {
            font-weight: 700;
            font-size: 16px;
        }

        section ul li {
            font-size: 14px;
            font-family: 'Noto Sans', sans-serif;
            font-family: 'Noto Sans KR', sans-serif;
            padding: 10px 0;
            /* border: 1px solid red; */
        }

        section .table_data li .fas {
            font-size: 18px;
        }

        section .table_title li:nth-child(1),
        section .table_data li:nth-child(1) {
            display: none;
        }

        section .table_data li .fas:hover {
            color: #1AB394;
        }

        section .table_title li,
        section .table_data li {
            text-align: center;
            /* border: 1px solid red; */
        }

        section .table_title li:nth-child(2),
        section .table_data li:nth-child(2) {
            width: 10%;
        }

        section .table_title li:nth-child(3),
        section .table_data li:nth-child(3) {
            width: 20%;
        }

        section .table_title li:nth-child(4),
        section .table_data li:nth-child(4) {
            width: 10%;
        }

        section .table_title li:nth-child(5),
        section .table_data li:nth-child(5) {
            width: 30%;
        }

        section .table_title li:nth-child(6),
        section .table_data li:nth-child(6),
        section .table_title li:nth-child(7),
        section .table_data li:nth-child(7),
        section .table_title li:nth-child(8),
        section .table_data li:nth-child(8) {
            width: 10%;
        }

        .star {
            font-size: 20px;
        }

        .star svg {
            width: 20px;
            height: 20px
        }

        .star svg path {
            fill-rule: evenodd;
            stroke: rgb(102, 100, 100);
            fill: none;
        }

        .star svg.fill path {
            color: rgb(255, 187, 68) !important;
        }

        /* PAGENATION */
        section .pagenation {
            justify-content: center;
            margin: 50px 0;
            border-bottom: 0;
        }

        section .pagenation li a {
            border: 1px solid #E7EAEC;
            padding: 8px 13px;
        }

        section .pagenation li a.on {
            background-color: #1AB394;
            color: #fff;
        }

        /* aside */
        aside {
            width: 40%;
            padding: 30px 20px;
            margin-bottom: 150px;
            display: none;
            box-sizing: initial;
        }

        aside.on {
            display: block;
        }

        aside ul {
            border: 1px solid #E7EAEC;
            margin-bottom: 50px;
            background-color: #fff;
        }

        aside li {
            width: 50%;
            display: inline-block;
            padding: 10px 20px;
            font-size: 14px;
            font-family: 'Noto Sans', sans-serif;
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #fff;
            /* border:1px solid red; */
        }

        aside li:nth-child(2n) {
            float: right;
        }

        aside li:last-child {
            width: 100%;
            background-color: #fff;
            border-top: 1px solid #E7EAEC;
        }

        aside li span:nth-child(2) {
            font-weight: 700;
        }

        /* MODAL */
        .modal {
            display: none;
            margin: 0 auto;
            width: 500px;
            background-color: #fff;
            position: fixed;
            box-shadow: 0px 0px 1px 10000px rgba(0, 0, 0, .5);
            left: 55%;
            top: 50px;
            transform: translate(-50%);
            padding: 20px 40px;
            border-radius: 5px;
            border: 10px solid rgba(26, 179, 148);
            z-index: 10;
        }

        .modal.on {
            display: block;
        }

        .modal .close_btn {
            display: block;
            text-align: right;
        }

        .modal .close_btn .fas {
            text-align: right;
            color: #1AB394;
            font-size: 25px;
        }

        .modal h2 {
            text-align: center;
            margin-bottom: 30px;
            font-family: 'Noto Sans KR', sans-serif;
        }

        .modal li {
            margin-bottom: 20px;
            box-sizing: border-box;
        }

        .modal label {
            display: inline-block;
            width: 150px;
            font-family: 'Noto Sans', sans-serif;
            font-family: 'Noto Sans KR', sans-serif;
            box-sizing: border-box;
            vertical-align: middle;
        }

        .modal input,
        .modal select,
        .modal textarea {
            display: inline-block;
            width: 60%;
            padding: 10px;
            margin-bottom: 10px;
            box-sizing: border-box;
            border: 1px solid #c8c9ca;
            border-radius: 5px;
        }

        .modal .button {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }

        .modal .button input {
            width: 20%;
            margin: 0 20px;
            border: 1px solid #9FAABE;
            font-family: 'Noto Sans', sans-serif;
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #E7EAEC;
        }

        .modal .button input:hover {
            background-color: #1AB394;
            color: #fff;
        }

        .modified_modal .none {
            border: 1px solid red;
            display: none;
        }
    </style>
</head>

<body>
    <div class="wrap clear">
        <header>
            <h1>
                <i class="fas fa-home"></i>
                3분 부동산
            </h1>
        </header>
        <nav>
            <ul>
                <li class="login_info">
                    <a href="">
                        <i class="fas fa-meh"></i>
                        <h3>최용호님</h3>
                    </a>
                </li>
                <li>
                    <a href="index.html">
                        <i class="fas fa-building"></i>
                        <span>현장 LIST</span>
                    </a>
                </li>
                <li>
                    <a href="customer.html">
                        <i class="fas fa-address-book"></i>
                        <span>고객 LIST</span>
                    </a>
                </li>
            </ul>
        </nav>
        <div class="sec_aside">
            <section class="">
                <div class="top">
                    <div class="search_bar">
                        <input type="search">
                        <a href=""><i class="fas fa-search"></i></a>
                    </div>
                    <button class="add_btn">add+</button>
                </div>
                <ul class="table_title">
                    <li><a href="">아이디</a></li>
                    <li><a href="">번호</a></li>
                    <li><a href="">이름</a></li>
                    <li><a href="">성별</a></li>
                    <li><a href="">연락처</a></li>
                    <li><a href="">수정</a></li>
                    <li><a href="">삭제</a></li>
                    <li><a href="">상담내역</a></li>
                </ul>
                <div id="customers"></div>
                <ul class="pagenation">
                    <li><a href="" class="prev">prev</a></li>
                    <li><a href="" class="on">1</a></li>
                    <li><a href="">2</a></li>
                    <li><a href="">3</a></li>
                    <li><a href="" class="prev">next</a></li>
                </ul>
            </section>
            <aside class="">
                <div class="top">
                    <button class="add_btn">add+</button>
                </div>
                <ul class="clear">
                    <li>
                        <span>상담일자 : </span>
                        <span>2020년 10월 2일</span>
                    </li>
                    <li>
                        <span>상담사 : </span>
                        <span>최용호</span>
                    </li>
                    <li>
                        <span>매물번호 : </span>
                        <span>200</span>
                    </li>
                    <li>
                        <span>관심도 : </span>
                        <span>★★★★★</span>
                    </li>
                    <li>
                        <p>
                            Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has
                            been the industry's standard dummy text ever since the 1500s, when an unknown printer took a
                            galley of type and scrambled it to make a type specimen book. It has survived not only five
                            centuries, but also the leap into electronic typesetting, remaining essentially unchanged.
                            It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum
                            passages, and more recently with desktop publishing software like Aldus PageMaker including
                            versions of Lorem Ipsum.
                        </p>
                    </li>
                </ul>
                <ul class="clear">
                    <li>
                        <span>상담일자 : </span>
                        <span>2020년 8월 2일</span>
                    </li>
                    <li>
                        <span>상담사 : </span>
                        <span>최우철</span>
                    </li>
                    <li>
                        <span>매물번호 : </span>
                        <span>400</span>
                    </li>
                    <li>
                        <span>관심도 : </span>
                        <span>★★★★★</span>
                    </li>
                    <li>
                        <p>
                            Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has
                            been the industry's standard dummy text ever since the 1500s, when an unknown printer took a
                            galley of type and scrambled it to make a type specimen book. It has survived not only five
                            centuries, but also the leap into electronic typesetting, remaining essentially unchanged.
                            It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum
                            passages, and more recently with desktop publishing software like Aldus PageMaker including
                            versions of Lorem Ipsum.
                        </p>
                    </li>
                </ul>
                <ul class="clear">
                    <li>
                        <span>상담일자 : </span>
                        <span>2020년 8월 2일</span>
                    </li>
                    <li>
                        <span>상담사 : </span>
                        <span>최우철</span>
                    </li>
                    <li>
                        <span>매물번호 : </span>
                        <span>400</span>
                    </li>
                    <li>
                        <span>관심도 : </span>
                        <span>★★★★★</span>
                    </li>
                    <li>
                        <p>
                            Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has
                            been the industry's standard dummy text ever since the 1500s, when an unknown printer took a
                            galley of type and scrambled it to make a type specimen book. It has survived not only five
                            centuries, but also the leap into electronic typesetting, remaining essentially unchanged.
                            It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum
                            passages, and more recently with desktop publishing software like Aldus PageMaker including
                            versions of Lorem Ipsum.
                        </p>
                    </li>
                </ul>
            </aside>
        </div>
        <article class="add_modal modal">
            <a href="" class="close_btn"><i class="fas fa-times-circle"></i></a>
            <ul class="modal_popup">
                <h2>고객정보 입력</h2>
                <li>
                    <label for="pname">이름</label>
                    <input type="text" id="pname">
                </li>
                <li>
                    <label for="gender">성별</label>
                    <select name="" id="gender">
                        <option value="남자">남자</option>
                        <option value="여자">여자</option>
                    </select>
                </li>
                <li>
                    <label for="phone">연락처</label>
                    <input type="number" id="phone">
                </li>
            </ul>
            <div class="button">
                <input type="reset">
                <input type="submit" value="등록">
            </div>
        </article>
        <article class="modified_modal modal">
            <a href="" class="close_btn"><i class="fas fa-times-circle"></i></a>
            <ul class="modal_popup">
                <h2>고객정보 입력</h2>
                <li class="none">
                    <label for="pid">아이디</label>
                    <input type="text" id="pid">
                </li>
                <li>
                    <label for="pname">이름</label>
                    <input type="text" id="pname">
                </li>
                <li>
                    <label for="gender">성별</label>
                    <select name="" id="gender">
                        <option value="남자">남자</option>
                        <option value="여자">여자</option>
                    </select>
                </li>
                <li>
                    <label for="phone">연락처</label>
                    <input type="number" id="phone">
                </li>
            </ul>
            <div class="button">
                <input type="reset">
                <input type="submit" value="수정">
            </div>
        </article>
    </div>
    <script>
        const section = document.querySelector('section');
        const aside = document.querySelector('aside');
        const stars = document.querySelectorAll('.star svg');
        const addModal = document.querySelector('.add_modal');

        customers();
        modal();

        // 모달팝업 open close
        function modal() {

            const closeBtn = document.querySelector('.close_btn');
            const addBtn = document.querySelector('.add_btn');

            addBtn.addEventListener('click', addUserModal);
            closeBtn.addEventListener('click', addUserModalClose);

            function addUserModal() {
                addModal.classList.add('on');
            }

            function addUserModalClose() {
                addModal.classList.remove('on');
            }
        };

        // ajax 리스트
        function customers() {

            $.ajax({
                type: 'GET',
                url: 'http://3min.yonghochoi.com/api/users?size=10',
                data: {},
                success: function (response) {
                    console.log(response)
                    const customer = document.querySelector('#customers');

                    if (!response.data) { //null이든 undefind든 메시지가 나오게 함
                        alert('데이터가 없습니다');
                        return;
                    }
                    for (let i = 0; i < response.data.length; i++) {
                        customer.innerHTML +=
                        `<ul class="table_data" id="${response.data[i].id}">
                            <li class="pid">${response.data[i].id}</li>
                            <li>${[i+1]}</li>
                            <li>${response.data[i].name}</li>
                            <li>${response.data[i].gender}</li>
                            <li>${response.data[i].phone}</li>
                            <li><i class="fas fa-edit modified"></i></li>
                            <li><i class="fas fa-trash-alt"></i></li>
                            <li class="show"><a href="">보기</a></li>
                        </ul>`
                    }

                    // 상담내역 '보기' 버튼 클릭 시
                    const show = document.querySelectorAll('.show');

                    for (let i = 0; i < show.length; i++) {
                        show[i].addEventListener('click', showAside);
                    }

                    function showAside(e) {
                        e.preventDefault()
                        console.log(e.target)

                        if (aside.classList.contains('on') && section.classList.contains('harf')) {
                            aside.classList.remove('on');
                            section.classList.remove('harf');
                        } else {
                            aside.classList.add('on');
                            section.classList.add('harf');
                        }
                    }

                    // 데이터 수정 ajax
                    const modifiedBtns = document.querySelectorAll('.modified');
                    const modifiedModal = document.querySelector('.modified_modal');
                    const modifiedModalBtn = document.querySelector('.modified_modal input[type=submit]');

                    for (let i = 0; i < modifiedBtns.length; i++) {
                        modifiedBtns[i].addEventListener('click', showModal);
                    }

                    modifiedModalBtn.addEventListener('click', modified)

                    function showModal() {
                        modifiedModal.classList.add('on');

                        const pid = this.parentNode.parentNode.children[0].textContent
                        const pname = this.parentNode.parentNode.children[2].textContent
                        const gender = this.parentNode.parentNode.children[3].textContent
                        const phone = this.parentNode.parentNode.children[4].textContent

                        modifiedModal.querySelector('#pid').value = pid
                        modifiedModal.querySelector('#pname').value = pname
                        modifiedModal.querySelector('#gender').value = gender
                        modifiedModal.querySelector('#phone').value = phone
                    }

                    function modified() {

                        const pid = modifiedModal.querySelector('#pid').value
                        const pname = modifiedModal.querySelector('#pname').value
                        const gender = modifiedModal.querySelector('#gender').value
                        const phone = modifiedModal.querySelector('#phone').value

                        console.log(pid)

                        $.ajax({
                            type: 'PUT',
                            url: `http://3min.yonghochoi.com/api/users/${pid}`,
                            data: {
                                name: pname,
                                gender: gender,
                                phone: phone,
                            },
                            success: function (response) {
                                console.log(response)
                                if (response['code'] === '200') {
                                    alert('수정 하였습니다');
                                    location.reload();
                                } else {
                                    alert('수정에 실패했습니다');
                                    location.reload();
                                }
                            }
                        });
                    }

                    const delBtn = document.querySelectorAll('.fa-trash-alt')
                    console.log(delBtn)

                    for (let i = 0; i < delBtn.length; i++) {
                        delBtn[i].addEventListener('click', deleteWork);
                    }

                    function deleteWork(e) {
                        const pid = e.target.parentNode.parentNode.id
                        console.log(pid)
                   
                        $.ajax({
                            type: 'DELETE',
                            url: `http://3min.yonghochoi.com/api/users/${pid}`,
                            data: {},
                            success: function (response) {
                                console.log(response)
                                if (response['code'] === '200') {
                                    alert('삭제되었습니다');
                                    location.reload();
                                } else {
                                    alert('삭제에 실패했습니다');
                                    location.reload();
                                }
                            }
                        });
                    }
                }
            });
        }

        for (let i = 0; i < stars.length; i++) {
            stars[i].addEventListener('click', clickWork)
        }

        function clickWork() {
            for (let i = 0; i < stars.length; i++) {
                stars[i].classList.add('fill')
            }
        }

        // 데이터 서버에 전달 ajax
        const submit = document.querySelector('input[type=submit]')
        submit.addEventListener('click', addUser)

        function addUser() {
            const pname = document.querySelector('#pname');
            const gender = document.querySelector('#gender');
            const phone = document.querySelector('#phone');

            $.ajax({
                type: 'POST',
                url: 'http://3min.yonghochoi.com/api/users',
                data: {
                    name: pname.value,
                    gender: gender.value,
                    phone: phone.value,
                },
                success: function (response) {
                    if (response['code'] === '200') {
                        alert('등록 했습니다');
                        location.reload();
                    } else {
                        alert('등록에 실패했습니다');
                        location.reload();
                    }
                }
            });
        }
    </script>
</body>

</html>